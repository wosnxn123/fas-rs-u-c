# 嵌入文件生成指南
## 版本 0.0.1

## 无记忆状态处理
- 识别方法：
  - 检查版本文件
  - 分析模块结构
  - 解析配置文件
- 更新流程：
  1. 扫描现有模块
  2. 识别关键功能
  3. 提取配置参数
  4. 生成更新文档
  5. 验证功能完整性

## 嵌入功能说明
- 嵌入内容：Zygisk模块
- 主要功能：
  - 拦截eBPF调用
  - 适配低版本内核
  - 提供兼容层
  - 新增功能：
    - 增强eBPF拦截机制
    - 优化低版本内核适配
    - 改进性能监控
- 技术实现：
  - 通过Zygisk框架注入
  - 使用hook技术拦截系统调用
  - 提供虚拟化接口
  - 新增实现：
    - 动态模块加载
    - 自动配置同步
    - 版本控制集成

## 0. 用户输入要求
- 主程序zip文件路径
- 目标输出目录
- 模块配置文件路径
- 版本号（可选，默认自动生成）

输入格式示例：
```bash
./auto_embed.sh \
  --input /path/to/program.zip \
  --output /path/to/output \
  --config /path/to/module_config.json \
  --version 1.0.0
```

## 1. 版本控制
- 主程序版本存储在`version.txt`
- 每个模块有自己的`version.txt`
- 版本格式：`主版本.次版本.修订号`

## 2. 模块识别
- 模块存储在`embed/modules/`目录
- 每个模块包含：
  - 核心实现文件
  - 配置文件
  - 版本文件
- 通过`module.prop`识别模块功能

## 3. 依赖提取
- 分析主程序`fas-rs`
- 解析`customize.sh`配置
- 提取`module.prop`中的依赖声明

## 4. 配置同步
- 主程序配置存储在`main/`目录
- 模块配置存储在各自目录
- 通过`customize.sh`同步配置

## 5. 生成步骤
1. 解压主程序zip文件
2. 复制主程序文件到临时目录
3. 嵌入模块文件
4. 同步配置文件
5. 重新打包为zip文件

## 6. 验证方法
- 检查输出文件结构
- 验证模块功能
- 测试主程序集成
- 检查版本一致性

## 7. 更新嵌入文件
1. 解压现有嵌入文件
2. 备份配置文件
3. 更新模块版本
4. 同步新配置
5. 验证兼容性
6. 重新打包

更新示例：
```bash
./auto_embed.sh \
  --update /path/to/existing_embedded.zip \
  --output /path/to/new_version \
  --version 2.0.0
```
